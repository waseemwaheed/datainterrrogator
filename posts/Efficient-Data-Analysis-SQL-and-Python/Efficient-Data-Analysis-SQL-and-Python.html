<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Waseem Waheed">
<meta name="dcterms.date" content="2021-08-10">

<title>Data Interrogator - Efficient Data Analysis - SQL and Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Data Interrogator</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/waseemwaheed" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/waseemwaheed/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Efficient Data Analysis - SQL and Python</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Python</div>
                <div class="quarto-category">SQL</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Waseem Waheed </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 10, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Performing data analysis, in many cases, requires loading the data from a database. Database engines are optimized for the efficient handling of data storage and retrieval. If the data is structured, which means the data follows a schema, querying the database is always performed using SQL, a domain specific language for data querying among other things.</p>
<p>I have been using Jupyter notebooks for 4 years now, and I think the notebook concept is transformational. Being able to mix the analysis with the compute in one linear document is great. The other day I was looking at some SQL queries and thought to myself, I wish that could write those queries in Jupyter notebooks just like I do with Python, I had previously tried Matlab and Julia, why not SQL?</p>
<p>As you would imagine, the community has thought about this question way before I did and someone has made that possible in the form of a IPython extension üòç.</p>
<p>This post is my attempt at using SQL in the Jupyter notebook environment. The data we are going to use in this excercise the <strong>20 years of Olympic history: athletes and results</strong> from <a href="https://www.kaggle.com/heesoo37/120-years-of-olympic-history-athletes-and-results">Kaggle</a>. The analysis presented here is for practice only and for more detailed analysis of the olympic games, check <a href="https://www.washingtonpost.com/sports/olympics/2021/07/31/oldest-youngest-olympians/">Olympians are probably older ‚Äî and younger ‚Äî than you think</a>.</p>
</section>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<p>I have few reasons for writing this article: 1. As a reminder for my future self, cause I tend to move on and forget üòÖ as you can imagine, 2. I hope it serves as an inspiration to you, the reader, to utilize this capability if you like it, 3. Practice SQL, which I can‚Äôt have enough of, 4. Being able to send the calculations to the data rather than bring the data to compute is a super power in the Big Data era, 5. Bringing the result of SQL queries back to Python rather than querying the database directly or using something like <a href="https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms">SQL Server Management Studio</a> or <a href="https://www.mysql.com/products/workbench/">MySQL Workbench</a> allows us to visualize the data in whatever way we like.</p>
<p>It is important to mention that whatever we are doing here can be done within <code>Pandas</code> directly, however from a <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/scale.html">scalability and effeciency perspectives</a>, the ability to do most of the filtering and summerization at the database level is a clear advantage.</p>
<p>The database can be hosted anywhere. Which means the machine on which the analysis is carried out doesn‚Äôt need to be highly resourced.</p>
<section id="why-not-an-orm" class="level3">
<h3 class="anchored" data-anchor-id="why-not-an-orm">Why not an ORM?</h3>
<p>ORM stands for Object Relational Mapping which according to <a href="https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping">wikipedia</a>: &gt; a programming technique for converting data between incompatible type systems using object-oriented programming languages. This creates, in effect, a ‚Äúvirtual object database‚Äù that can be used from within the programming language.</p>
<p>ORMs hide the typical SQL interaction from the software developer, exposing the database as classes and objects with getters and setters. An typical example of an ORM are <code>SQLAlchemy</code> and <code>SQLModel</code> which builds on top <code>SQLAlchemy</code>. If you think that this is a good idea, I tend to agree as do most web frameworks but, the goal of this article is not to run away from SQL but to embrace it as universal tool that can be utilized on its own and in combination with most programming languages.</p>
</section>
<section id="why-not-spark-or-the-likes" class="level3">
<h3 class="anchored" data-anchor-id="why-not-spark-or-the-likes">Why not Spark (or the likes)</h3>
<p>This is a great question. If you have heard of Big Data tools such as <a href="https://spark.apache.org/">Spark</a>, this question would defintely come to your mind. Spark does what we are trying to achieve, and I am planning to cover it in a follow up writeup.</p>
<p>Hopefully, I managed to convince you of the benefits of being able to query databases using SQL rather than doing the same analysis in Pandas.</p>
</section>
</section>
<section id="required-packages" class="level2">
<h2 class="anchored" data-anchor-id="required-packages">Required packages</h2>
<p>I am going to use the following packages in this article:</p>
<ul>
<li><a href="https://pypi.org/project/ipython-sql/"><code>ipython-sql</code></a></li>
<li><a href="https://pandas.pydata.org/"><code>Pandas</code></a></li>
<li><a href="https://matplotlib.org/"><code>Matplotlib</code></a></li>
<li><a href="https://www.sqlalchemy.org/"><code>SQLAlchemy</code></a></li>
</ul>
</section>
<section id="connecting-to-database" class="level2">
<h2 class="anchored" data-anchor-id="connecting-to-database">Connecting to database</h2>
<p>This first step is to establish a connection to the database you would like to work on. We are going to use the <code>ipython-sql</code> extension to write and pass our SQL queries. <code>ipython-sql</code> expects database string similar to those used by <code>SQLAlcehmy</code>. For more details about the database strings check <a href="https://docs.sqlalchemy.org/en/14/core/engines.html#database-urls">this page</a>.</p>
<p>In this article, I am going to use a local installation of <a href="https://www.microsoft.com/en-au/sql-server/sql-server-downloads">Microsoft SQL Server 2019 Express</a>. I have already downloaded MS-SQL server already and installed it. I then created a new database named <code>OlympicsHistory</code> and imported the two csv files from the Olympic History dataset into this database as a tables named <code>athlete_events</code>, <code>noc_region</code> .</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext sql</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql mssql<span class="op">+</span>pyodbc:<span class="op">//@</span>localhost\SQLEXPRESS<span class="op">/</span>OlympicsHistory?trusted_connection<span class="op">=</span>yes<span class="op">&amp;</span>driver<span class="op">=</span>SQL<span class="op">+</span>Server</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-handle-queries-and-results" class="level2">
<h2 class="anchored" data-anchor-id="how-to-handle-queries-and-results">How to handle queries and results</h2>
<p>Now that you succeeded connecting to the database, let‚Äôs see how can we bring data from the database into Python. The <code>ipython-sql</code> extension offers three mode of access:</p>
<pre><code>1. Print the results
2. Assignning the result of a single-line query 
3. Assignning the result of a multi-line query</code></pre>
<p><strong>Note:</strong> ignore the details of the queries for now and let‚Äôs focus on the handling of queries, we will return to the details of the queries in the following section.</p>
<section id="print-the-results" class="level3">
<h3 class="anchored" data-anchor-id="print-the-results">1. Print the results</h3>
<p>You use the magic command (<a href="https://ipython.readthedocs.io/en/stable/interactive/magics.html">to learn more</a>) <code>%sql</code> for a single line and <code>%%sql</code> for multi-line queries.</p>
<p>1.1. Single line query</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql SELECT DISTINCT TOP <span class="dv">3</span> Sport FROM   athlete_events </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sport</td>
</tr>
<tr class="even">
<td>Basketball</td>
</tr>
<tr class="odd">
<td>Judo</td>
</tr>
<tr class="even">
<td>Football</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>1.2. Multi-line query</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>SELECT DISTINCT TOP <span class="dv">3</span> Sport</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sport</td>
</tr>
<tr class="even">
<td>Basketball</td>
</tr>
<tr class="odd">
<td>Judo</td>
</tr>
<tr class="even">
<td>Football</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="assignning-the-result-of-a-single-line-query" class="level3">
<h3 class="anchored" data-anchor-id="assignning-the-result-of-a-single-line-query">2. Assignning the result of a single-line query</h3>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="op">%</span>sql SELECT DISTINCT TOP <span class="dv">3</span> Sport FROM   athlete_events</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.
+------------+
|   Sport    |
+------------+
| Basketball |
|    Judo    |
|  Football  |
+------------+</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql result <span class="op">&lt;&lt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>SELECT TOP <span class="dv">3</span> year,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>             Count(CASE</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                     WHEN Medal <span class="op">=</span> <span class="st">'Bronze'</span> THEN <span class="dv">1</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                   END) Bronze,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>             Count(CASE</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                     WHEN Medal <span class="op">=</span> <span class="st">'Silver'</span> THEN <span class="dv">1</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                   END) Silver,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>             Count(CASE</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                     WHEN Medal <span class="op">=</span> <span class="st">'Gold'</span> THEN <span class="dv">1</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                   END) Gold</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>GROUP  BY Year</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>ORDER  BY Year </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.
Returning data to local variable result</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+--------+--------+------+
| year | Bronze | Silver | Gold |
+------+--------+--------+------+
| 1896 |   38   |   43   |  62  |
| 1900 |  175   |  228   | 201  |
| 1904 |  150   |  163   | 173  |
+------+--------+--------+------+</code></pre>
</div>
</div>
<p>If have used Python for data analysis, you might say this cool but, it would even nice if we could capture the result of the query as <code>Pandas</code> DataFrame! If you had this question in mind, to you I say, it is straight forward to that, have a look:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> result.DataFrame()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year  Bronze  Silver  Gold
0  1896      38      43    62
1  1900     175     228   201
2  1904     150     163   173</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>pandas.core.frame.DataFrame</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">Bronze</th>
<th data-quarto-table-cell-role="th">Silver</th>
<th data-quarto-table-cell-role="th">Gold</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>3.0</td>
<td>3.000000</td>
<td>3.000000</td>
<td>3.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>1900.0</td>
<td>121.000000</td>
<td>144.666667</td>
<td>145.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>4.0</td>
<td>72.958893</td>
<td>93.852722</td>
<td>73.514171</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1896.0</td>
<td>38.000000</td>
<td>43.000000</td>
<td>62.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>1898.0</td>
<td>94.000000</td>
<td>103.000000</td>
<td>117.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>1900.0</td>
<td>150.000000</td>
<td>163.000000</td>
<td>173.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1902.0</td>
<td>162.500000</td>
<td>195.500000</td>
<td>187.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1904.0</td>
<td>175.000000</td>
<td>228.000000</td>
<td>201.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>I hope that you can see the power in what I just demonstrated.</p>
</section>
</section>
<section id="data-analysis-using-sql" class="level2">
<h2 class="anchored" data-anchor-id="data-analysis-using-sql">Data Analysis using SQL</h2>
<p>Enough of the preparation, let‚Äôs into the fun part, analysing the data, asking and answering questions about it.</p>
<p>As a first step, let‚Äôs familiarize ourselves with the two tables we have</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql SELECT TOP <span class="dv">5</span> <span class="op">*</span> FROM   athlete_events </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ID</td>
<td data-quarto-table-cell-role="th">Name</td>
<td data-quarto-table-cell-role="th">Sex</td>
<td data-quarto-table-cell-role="th">Age</td>
<td data-quarto-table-cell-role="th">Height</td>
<td data-quarto-table-cell-role="th">Weight</td>
<td data-quarto-table-cell-role="th">Team</td>
<td data-quarto-table-cell-role="th">NOC</td>
<td data-quarto-table-cell-role="th">Games</td>
<td data-quarto-table-cell-role="th">Year</td>
<td data-quarto-table-cell-role="th">Season</td>
<td data-quarto-table-cell-role="th">City</td>
<td data-quarto-table-cell-role="th">Sport</td>
<td data-quarto-table-cell-role="th">Event</td>
<td data-quarto-table-cell-role="th">Medal</td>
</tr>
<tr class="even">
<td>1</td>
<td>A Dijiang</td>
<td>M</td>
<td>24</td>
<td>180</td>
<td>80</td>
<td>China</td>
<td>CHN</td>
<td>1992 Summer</td>
<td>1992</td>
<td>Summer</td>
<td>Barcelona</td>
<td>Basketball</td>
<td>Basketball Men's Basketball</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>2</td>
<td>A Lamusi</td>
<td>M</td>
<td>23</td>
<td>170</td>
<td>60</td>
<td>China</td>
<td>CHN</td>
<td>2012 Summer</td>
<td>2012</td>
<td>Summer</td>
<td>London</td>
<td>Judo</td>
<td>Judo Men's Extra-Lightweight</td>
<td>NA</td>
</tr>
<tr class="even">
<td>3</td>
<td>Gunnar Nielsen Aaby</td>
<td>M</td>
<td>24</td>
<td>NA</td>
<td>NA</td>
<td>Denmark</td>
<td>DEN</td>
<td>1920 Summer</td>
<td>1920</td>
<td>Summer</td>
<td>Antwerpen</td>
<td>Football</td>
<td>Football Men's Football</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>4</td>
<td>Edgar Lindenau Aabye</td>
<td>M</td>
<td>34</td>
<td>NA</td>
<td>NA</td>
<td>Denmark/Sweden</td>
<td>DEN</td>
<td>1900 Summer</td>
<td>1900</td>
<td>Summer</td>
<td>Paris</td>
<td>Tug-Of-War</td>
<td>Tug-Of-War Men's Tug-Of-War</td>
<td>Gold</td>
</tr>
<tr class="even">
<td>5</td>
<td>Christine Jacoba Aaftink</td>
<td>F</td>
<td>21</td>
<td>185</td>
<td>82</td>
<td>Netherlands</td>
<td>NED</td>
<td>1988 Winter</td>
<td>1988</td>
<td>Winter</td>
<td>Calgary</td>
<td>Speed Skating</td>
<td>Speed Skating Women's 500 metres</td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql SELECT TOP <span class="dv">5</span> <span class="op">*</span> FROM   noc_regions </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">NOC</td>
<td data-quarto-table-cell-role="th">region</td>
<td data-quarto-table-cell-role="th">notes</td>
</tr>
<tr class="even">
<td>AFG</td>
<td>Afghanistan</td>
<td>None</td>
</tr>
<tr class="odd">
<td>AHO</td>
<td>Curacao</td>
<td>Netherlands Antilles</td>
</tr>
<tr class="even">
<td>ALB</td>
<td>Albania</td>
<td>None</td>
</tr>
<tr class="odd">
<td>ALG</td>
<td>Algeria</td>
<td>None</td>
</tr>
<tr class="even">
<td>AND</td>
<td>Andorra</td>
<td>None</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>SELECT DISTINCT athlete_events.noc</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>       LEFT JOIN noc_regions</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>              ON athlete_events.noc <span class="op">=</span> noc_regions.noc</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>WHERE  region IS NULL </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">noc</td>
</tr>
<tr class="even">
<td>SGP</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Looking up <code>SGP</code> reveals that this is the code for <a href="https://olympics.com/ioc/singapore">Singapore</a>. This begs the question, why was this code missing from the <code>noc_regions</code> table? Let‚Äôs further investigate this table</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>SELECT <span class="op">*</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>FROM   noc_regions</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>WHERE  region LIKE <span class="st">'%pore'</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">NOC</td>
<td data-quarto-table-cell-role="th">region</td>
<td data-quarto-table-cell-role="th">notes</td>
</tr>
<tr class="even">
<td>SIN</td>
<td>Singapore</td>
<td>None</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let‚Äôs further investigate the <code>athlete_events</code> table for instances of the codes <code>SIN</code> and <code>SGP</code></p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>SELECT DISTINCT team,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                noc</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>WHERE  team LIKE <span class="st">'%pore'</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        OR noc <span class="op">=</span> <span class="st">'SGP'</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        OR noc <span class="op">=</span> <span class="st">'SIN'</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">team</td>
<td data-quarto-table-cell-role="th">noc</td>
</tr>
<tr class="even">
<td>June Climene</td>
<td>SGP</td>
</tr>
<tr class="odd">
<td>Rika II</td>
<td>SGP</td>
</tr>
<tr class="even">
<td>Singapore</td>
<td>SGP</td>
</tr>
<tr class="odd">
<td>Singapore-1</td>
<td>SGP</td>
</tr>
<tr class="even">
<td>Singapore-2</td>
<td>SGP</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Ok, so the code <code>SIN</code> has never been used in the <code>athlete_events</code>. A quick <a href="https://www.facebook.com/sgolympics/photos/a.1591488417735290/1747292968821500/?type=3">web search</a> revealed that <code>SGP</code> has replaced <code>SIN</code> in 2016.</p>
<p>In this case, I think, it would be a good idea to keep both codes in the <code>noc_regions</code> table. Let‚Äôs add <code>SGP</code></p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#collapse_output</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>IF NOT EXISTS (SELECT <span class="op">*</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>               FROM   noc_regions</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>               WHERE  noc <span class="op">=</span> <span class="st">'SGP'</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  INSERT INTO noc_regions</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  VALUES      (<span class="st">'SGP'</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">'Singapore'</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>               <span class="st">'Added by Waseem'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
1 rows affected.</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>ResourceClosedError: This result object does not return rows. It has been closed automatically.</code></pre>
</div>
</div>
<p>There seems to be a bug in <code>SQLAlchemy</code> which makes ealier SQL code error. We can safely ignore this error as the code seems to be doing what is supposed to do, let‚Äôs verify:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>SELECT <span class="op">*</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>FROM   noc_regions</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>WHERE  noc <span class="op">=</span> <span class="st">'SGP'</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">NOC</td>
<td data-quarto-table-cell-role="th">region</td>
<td data-quarto-table-cell-role="th">notes</td>
</tr>
<tr class="even">
<td>SGP</td>
<td>Singapore</td>
<td>Added by Waseem</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can now perform joins without any <code>NULL</code>s.</p>
<p>Let‚Äôs begin with the data interrogation:</p>
<section id="which-cities-host-the-olympics-more-that-once" class="level4">
<h4 class="anchored" data-anchor-id="which-cities-host-the-olympics-more-that-once">Which cities host the Olympics more that once?</h4>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql cities <span class="op">&lt;&lt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>SELECT City,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>       Count(Year) AS NumTimes</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>FROM   (SELECT DISTINCT year,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                        city</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        FROM   athlete_events) city</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>GROUP  BY city</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>HAVING Count(year) <span class="op">&gt;</span> <span class="dv">1</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>ORDER  BY numtimes DESC </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.
Returning data to local variable cities</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>cities_df <span class="op">=</span> cities.DataFrame()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>cities_df.plot.bar(x<span class="op">=</span><span class="st">'City'</span>, y<span class="op">=</span><span class="st">'NumTimes'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>&lt;AxesSubplot:xlabel='City'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Efficient-Data-Analysis-SQL-and-Python_files/figure-html/cell-20-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#collapse_output</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>CREATE OR ALTER VIEW city_year AS</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>SELECT DISTINCT City,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                Year</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>FROM            athlete_events</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>ResourceClosedError: This result object does not return rows. It has been closed automatically.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>SELECT City,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>       Count(Year) AS NumTimes</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>FROM   city_year</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>GROUP  BY City</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>HAVING Count(Year) <span class="op">&gt;</span> <span class="dv">1</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>ORDER  BY numtimes DESC </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">City</td>
<td data-quarto-table-cell-role="th">NumTimes</td>
</tr>
<tr class="even">
<td>London</td>
<td>3</td>
</tr>
<tr class="odd">
<td>Athina</td>
<td>3</td>
</tr>
<tr class="even">
<td>Sankt Moritz</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Innsbruck</td>
<td>2</td>
</tr>
<tr class="even">
<td>Lake Placid</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Stockholm</td>
<td>2</td>
</tr>
<tr class="even">
<td>Los Angeles</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Paris</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="find-the-seasons-for-each-year-as-two-columns-summer-winter" class="level4">
<h4 class="anchored" data-anchor-id="find-the-seasons-for-each-year-as-two-columns-summer-winter">Find the seasons for each year as two columns (Summer, Winter)</h4>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>SELECT <span class="op">*</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>FROM   (SELECT DISTINCT PARSENAME(REPLACE(Games, <span class="st">' '</span>, <span class="st">'.'</span>), <span class="dv">2</span>) AS Year,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                        PARSENAME(REPLACE(Games, <span class="st">' '</span>, <span class="st">'.'</span>), <span class="dv">1</span>) AS Season</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        FROM   athlete_events) t1</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>       PIVOT ( Count(Season)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>             FOR Season IN (Summer,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                            Winter) ) piv</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>ORDER  BY Year </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Year</td>
<td data-quarto-table-cell-role="th">Summer</td>
<td data-quarto-table-cell-role="th">Winter</td>
</tr>
<tr class="even">
<td>1896</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1900</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>1904</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1906</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>1908</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1912</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>1920</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1924</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1928</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1932</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1936</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1948</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1952</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1956</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1960</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1964</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1968</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1972</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1976</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1980</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1984</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1988</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1992</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1994</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>1996</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1998</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>2000</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>2002</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>2004</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>2006</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>2008</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>2010</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>2012</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>2014</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>2016</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="what-is-the-average-age-of-participants" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-average-age-of-participants">What is the average age of participants?</h4>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>SELECT Avg(Cast(Age AS INT)) <span class="im">as</span> AvgAge</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>WHERE  age IS NOT NULL</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>       AND age <span class="op">&lt;&gt;</span> <span class="st">'NA'</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="23">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AvgAge</td>
</tr>
<tr class="even">
<td>25</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="what-is-the-average-age-per-season" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-average-age-per-season">What is the average age per season?</h4>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>SELECT Season,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>       Avg(CAST(Age AS INT)) AvgAge</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>WHERE  Age <span class="op">&lt;&gt;</span> <span class="st">'NA'</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>GROUP  BY Season </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="24">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Season</td>
<td data-quarto-table-cell-role="th">AvgAge</td>
</tr>
<tr class="even">
<td>Summer</td>
<td>25</td>
</tr>
<tr class="odd">
<td>Winter</td>
<td>25</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="is-the-average-age-fixed-across-the-seasons-and-years" class="level4">
<h4 class="anchored" data-anchor-id="is-the-average-age-fixed-across-the-seasons-and-years">Is the average age fixed across the seasons and years?</h4>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql result <span class="op">&lt;&lt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>SELECT Year, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>       Season, </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>       AVG(cast(Age <span class="im">as</span> <span class="bu">int</span>)) AverageAge </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>WHERE Age <span class="kw">is</span> <span class="kw">not</span> NULL </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>      AND Age <span class="op">&lt;&gt;</span> <span class="st">'NA'</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>GROUP BY Year, </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>         Season</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>ORDER BY Year, </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>         Season</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.
Returning data to local variable result</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>result_df <span class="op">=</span> result.DataFrame()</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>summer_df <span class="op">=</span> result_df[result_df[<span class="st">'Season'</span>] <span class="op">==</span> <span class="st">'Summer'</span>]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>winter_df <span class="op">=</span> result_df[result_df[<span class="st">'Season'</span>] <span class="op">==</span> <span class="st">'Winter'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>summer_df.plot.scatter(x<span class="op">=</span><span class="st">'Year'</span>,y<span class="op">=</span><span class="st">'AverageAge'</span>, title<span class="op">=</span><span class="st">'Summer Participants Average Age'</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>winter_df.plot.scatter(x<span class="op">=</span><span class="st">'Year'</span>,y<span class="op">=</span><span class="st">'AverageAge'</span>, title<span class="op">=</span><span class="st">'Winter Participants Average Age'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>&lt;AxesSubplot:title={'center':'Winter Participants Average Age'}, xlabel='Year', ylabel='AverageAge'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Efficient-Data-Analysis-SQL-and-Python_files/figure-html/cell-28-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Efficient-Data-Analysis-SQL-and-Python_files/figure-html/cell-28-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>The average for summer Olympics in 1932 looks too high, is this a valid result? if yes why did it happen?</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>select AVG(cast(Age <span class="im">as</span> <span class="bu">int</span>)) <span class="im">as</span> AvgAge <span class="im">from</span> athlete_events</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>left join noc_regions on athlete_events.NOC <span class="op">=</span> noc_regions.NOC</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>where Year<span class="op">=</span><span class="dv">1932</span> <span class="kw">and</span> Age <span class="op">&lt;&gt;</span> <span class="st">'NA'</span> <span class="kw">and</span> Season<span class="op">=</span><span class="st">'Summer'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AvgAge</td>
</tr>
<tr class="even">
<td>33</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So, the average age was high, why is that the case? Let‚Äôs look at a more statistics about the games broken down by year and season.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>SELECT year,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>       Min(CASE</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Summer'</span> THEN Cast(age AS INT)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>           END) SummerMinAge,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>       Max(CASE</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Summer'</span> THEN Cast(age AS INT)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>           END) SummerMaxAge,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>       Avg(CASE</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Summer'</span> THEN Cast(age AS INT)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>           END) SummerAvgAge,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>       Var(CASE</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Summer'</span> THEN Cast(age AS INT)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>           END) SummerVarAge,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>       Min(CASE</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Winter'</span> THEN Cast(age AS INT)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>           END) WinterMinAge,</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>       Max(CASE</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Winter'</span> THEN Cast(age AS INT)</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>           END) WinterMaxAge,</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>       Avg(CASE</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Winter'</span> THEN Cast(age AS INT)</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>           END) WinterAvgAge,</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>       Var(CASE</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Winter'</span> THEN Cast(age AS INT)</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>           END) WinterVarAge</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>WHERE  age IS NOT NULL</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>       AND age <span class="op">&lt;&gt;</span> <span class="st">'NA'</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>GROUP  BY year</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>ORDER  BY year </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="29">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">year</td>
<td data-quarto-table-cell-role="th">SummerMinAge</td>
<td data-quarto-table-cell-role="th">SummerMaxAge</td>
<td data-quarto-table-cell-role="th">SummerAvgAge</td>
<td data-quarto-table-cell-role="th">SummerVarAge</td>
<td data-quarto-table-cell-role="th">WinterMinAge</td>
<td data-quarto-table-cell-role="th">WinterMaxAge</td>
<td data-quarto-table-cell-role="th">WinterAvgAge</td>
<td data-quarto-table-cell-role="th">WinterVarAge</td>
</tr>
<tr class="even">
<td>1896</td>
<td>10</td>
<td>40</td>
<td>23</td>
<td>22.02240143369178</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>1900</td>
<td>13</td>
<td>71</td>
<td>29</td>
<td>87.57875351516955</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td>1904</td>
<td>14</td>
<td>71</td>
<td>26</td>
<td>76.6066534940619</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>1906</td>
<td>13</td>
<td>54</td>
<td>27</td>
<td>62.617258530706444</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td>1908</td>
<td>14</td>
<td>61</td>
<td>26</td>
<td>61.15578403594632</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>1912</td>
<td>13</td>
<td>67</td>
<td>27</td>
<td>64.84038295212197</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td>1920</td>
<td>13</td>
<td>72</td>
<td>29</td>
<td>68.44374620002326</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>1924</td>
<td>13</td>
<td>81</td>
<td>28</td>
<td>74.08304035936791</td>
<td>11</td>
<td>58</td>
<td>27</td>
<td>48.97374171326985</td>
</tr>
<tr class="even">
<td>1928</td>
<td>11</td>
<td>97</td>
<td>29</td>
<td>118.93684427853675</td>
<td>15</td>
<td>54</td>
<td>26</td>
<td>37.10742966900141</td>
</tr>
<tr class="odd">
<td>1932</td>
<td>13</td>
<td>96</td>
<td>33</td>
<td>202.85578680390805</td>
<td>11</td>
<td>52</td>
<td>25</td>
<td>33.449755356216194</td>
</tr>
<tr class="even">
<td>1936</td>
<td>12</td>
<td>74</td>
<td>27</td>
<td>76.48352848554916</td>
<td>11</td>
<td>46</td>
<td>25</td>
<td>24.044063840363208</td>
</tr>
<tr class="odd">
<td>1948</td>
<td>12</td>
<td>84</td>
<td>29</td>
<td>93.24748654592041</td>
<td>15</td>
<td>53</td>
<td>26</td>
<td>32.50355943000253</td>
</tr>
<tr class="even">
<td>1952</td>
<td>13</td>
<td>65</td>
<td>26</td>
<td>43.83151104313369</td>
<td>12</td>
<td>47</td>
<td>25</td>
<td>26.63744994317875</td>
</tr>
<tr class="odd">
<td>1956</td>
<td>13</td>
<td>67</td>
<td>26</td>
<td>43.08506131207035</td>
<td>12</td>
<td>48</td>
<td>25</td>
<td>25.929199837782704</td>
</tr>
<tr class="even">
<td>1960</td>
<td>12</td>
<td>65</td>
<td>25</td>
<td>38.08302692628261</td>
<td>11</td>
<td>39</td>
<td>24</td>
<td>20.080557267666588</td>
</tr>
<tr class="odd">
<td>1964</td>
<td>12</td>
<td>60</td>
<td>25</td>
<td>31.975105597154663</td>
<td>13</td>
<td>53</td>
<td>24</td>
<td>21.768654166104547</td>
</tr>
<tr class="even">
<td>1968</td>
<td>11</td>
<td>68</td>
<td>24</td>
<td>36.317311148018874</td>
<td>11</td>
<td>51</td>
<td>24</td>
<td>18.71876641678888</td>
</tr>
<tr class="odd">
<td>1972</td>
<td>12</td>
<td>69</td>
<td>24</td>
<td>35.930160546839694</td>
<td>13</td>
<td>42</td>
<td>24</td>
<td>19.98596052286161</td>
</tr>
<tr class="even">
<td>1976</td>
<td>12</td>
<td>70</td>
<td>23</td>
<td>32.802134361215664</td>
<td>12</td>
<td>46</td>
<td>23</td>
<td>21.7698320494643</td>
</tr>
<tr class="odd">
<td>1980</td>
<td>13</td>
<td>70</td>
<td>23</td>
<td>27.768520445745068</td>
<td>13</td>
<td>49</td>
<td>23</td>
<td>18.154642359559396</td>
</tr>
<tr class="even">
<td>1984</td>
<td>12</td>
<td>60</td>
<td>24</td>
<td>30.05881562619138</td>
<td>15</td>
<td>53</td>
<td>23</td>
<td>16.397695807730326</td>
</tr>
<tr class="odd">
<td>1988</td>
<td>13</td>
<td>70</td>
<td>24</td>
<td>29.150256275905534</td>
<td>11</td>
<td>52</td>
<td>23</td>
<td>17.46205581946204</td>
</tr>
<tr class="even">
<td>1992</td>
<td>11</td>
<td>62</td>
<td>24</td>
<td>29.238076996153065</td>
<td>13</td>
<td>46</td>
<td>24</td>
<td>17.08599797046234</td>
</tr>
<tr class="odd">
<td>1994</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>13</td>
<td>46</td>
<td>24</td>
<td>17.603527791814635</td>
</tr>
<tr class="even">
<td>1996</td>
<td>12</td>
<td>63</td>
<td>24</td>
<td>30.263060247773502</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>1998</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>14</td>
<td>50</td>
<td>25</td>
<td>19.702398658160618</td>
</tr>
<tr class="even">
<td>2000</td>
<td>13</td>
<td>63</td>
<td>25</td>
<td>29.60243153446837</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>2002</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>15</td>
<td>48</td>
<td>25</td>
<td>22.23690379230238</td>
</tr>
<tr class="even">
<td>2004</td>
<td>13</td>
<td>57</td>
<td>25</td>
<td>31.13741181652509</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>2006</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>14</td>
<td>52</td>
<td>25</td>
<td>23.876212746402683</td>
</tr>
<tr class="even">
<td>2008</td>
<td>12</td>
<td>67</td>
<td>25</td>
<td>32.32947785953114</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>2010</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>15</td>
<td>51</td>
<td>26</td>
<td>25.120888173261157</td>
</tr>
<tr class="even">
<td>2012</td>
<td>13</td>
<td>71</td>
<td>25</td>
<td>32.28653359213402</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>2014</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>15</td>
<td>55</td>
<td>25</td>
<td>23.517221690522096</td>
</tr>
<tr class="even">
<td>2016</td>
<td>13</td>
<td>62</td>
<td>26</td>
<td>30.917678201428895</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>It is clear that there‚Äôs a high variability in participants ages in 1932. Let‚Äôs have a closer look at the data to find out what could the reason behind that be.</p>
<p>In which sport did older participants take part in?</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>select top <span class="dv">10</span> <span class="op">*</span> <span class="im">from</span> athlete_events</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>where year <span class="op">=</span> <span class="st">'1932'</span> <span class="kw">and</span> season <span class="op">=</span> <span class="st">'Summer'</span> <span class="kw">and</span> age <span class="op">&lt;&gt;</span> <span class="st">'NA'</span> <span class="kw">and</span> age <span class="op">=</span> <span class="dv">96</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ID</td>
<td data-quarto-table-cell-role="th">Name</td>
<td data-quarto-table-cell-role="th">Sex</td>
<td data-quarto-table-cell-role="th">Age</td>
<td data-quarto-table-cell-role="th">Height</td>
<td data-quarto-table-cell-role="th">Weight</td>
<td data-quarto-table-cell-role="th">Team</td>
<td data-quarto-table-cell-role="th">NOC</td>
<td data-quarto-table-cell-role="th">Games</td>
<td data-quarto-table-cell-role="th">Year</td>
<td data-quarto-table-cell-role="th">Season</td>
<td data-quarto-table-cell-role="th">City</td>
<td data-quarto-table-cell-role="th">Sport</td>
<td data-quarto-table-cell-role="th">Event</td>
<td data-quarto-table-cell-role="th">Medal</td>
</tr>
<tr class="even">
<td>49663</td>
<td>Winslow Homer</td>
<td>M</td>
<td>96</td>
<td>NA</td>
<td>NA</td>
<td>United States</td>
<td>USA</td>
<td>1932 Summer</td>
<td>1932</td>
<td>Summer</td>
<td>Los Angeles</td>
<td>Art Competitions</td>
<td>Art Competitions Mixed Painting, Unknown Event</td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Oh, the older folks participated in Art Competitions. Let‚Äôs see what impact does removing <code>Art Competitions</code> have on the age distribution.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>SELECT year,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>       Min(CASE</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Summer'</span> THEN Cast(age AS INT)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>           END) SummerMinAge,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>       Max(CASE</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Summer'</span> THEN Cast(age AS INT)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>           END) SummerMaxAge,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>       Avg(CASE</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Summer'</span> THEN Cast(age AS INT)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>           END) SummerAvgAge,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>       Var(CASE</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Summer'</span> THEN Cast(age AS INT)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>           END) SummerVarAge,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>       Min(CASE</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Winter'</span> THEN Cast(age AS INT)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>           END) WinterMinAge,</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>       Max(CASE</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Winter'</span> THEN Cast(age AS INT)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>           END) WinterMaxAge,</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>       Avg(CASE</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Winter'</span> THEN Cast(age AS INT)</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>           END) WinterAvgAge,</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>       Var(CASE</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>             WHEN season <span class="op">=</span> <span class="st">'Winter'</span> THEN Cast(age AS INT)</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>           END) WinterVarAge</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>WHERE  age IS NOT NULL</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>       AND age <span class="op">&lt;&gt;</span> <span class="st">'NA'</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>       AND Sport <span class="op">&lt;&gt;</span> <span class="st">'Art Competitions'</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>GROUP  BY year</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>ORDER  BY year </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">year</td>
<td data-quarto-table-cell-role="th">SummerMinAge</td>
<td data-quarto-table-cell-role="th">SummerMaxAge</td>
<td data-quarto-table-cell-role="th">SummerAvgAge</td>
<td data-quarto-table-cell-role="th">SummerVarAge</td>
<td data-quarto-table-cell-role="th">WinterMinAge</td>
<td data-quarto-table-cell-role="th">WinterMaxAge</td>
<td data-quarto-table-cell-role="th">WinterAvgAge</td>
<td data-quarto-table-cell-role="th">WinterVarAge</td>
</tr>
<tr class="even">
<td>1896</td>
<td>10</td>
<td>40</td>
<td>23</td>
<td>22.02240143369178</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>1900</td>
<td>13</td>
<td>71</td>
<td>29</td>
<td>87.57875351516955</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td>1904</td>
<td>14</td>
<td>71</td>
<td>26</td>
<td>76.6066534940619</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>1906</td>
<td>13</td>
<td>54</td>
<td>27</td>
<td>62.617258530706444</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td>1908</td>
<td>14</td>
<td>61</td>
<td>26</td>
<td>61.15578403594632</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>1912</td>
<td>13</td>
<td>64</td>
<td>27</td>
<td>62.604400100967034</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td>1920</td>
<td>13</td>
<td>72</td>
<td>29</td>
<td>67.98906348229981</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>1924</td>
<td>13</td>
<td>60</td>
<td>27</td>
<td>54.157015903460966</td>
<td>11</td>
<td>58</td>
<td>27</td>
<td>48.97374171326985</td>
</tr>
<tr class="even">
<td>1928</td>
<td>11</td>
<td>63</td>
<td>25</td>
<td>47.05709575019104</td>
<td>15</td>
<td>54</td>
<td>26</td>
<td>37.10742966900141</td>
</tr>
<tr class="odd">
<td>1932</td>
<td>13</td>
<td>54</td>
<td>25</td>
<td>38.055043191309956</td>
<td>11</td>
<td>52</td>
<td>25</td>
<td>33.449755356216194</td>
</tr>
<tr class="even">
<td>1936</td>
<td>12</td>
<td>72</td>
<td>25</td>
<td>35.960182685284465</td>
<td>11</td>
<td>46</td>
<td>25</td>
<td>24.044063840363208</td>
</tr>
<tr class="odd">
<td>1948</td>
<td>12</td>
<td>61</td>
<td>27</td>
<td>50.99427202894765</td>
<td>15</td>
<td>53</td>
<td>26</td>
<td>32.50355943000253</td>
</tr>
<tr class="even">
<td>1952</td>
<td>13</td>
<td>65</td>
<td>26</td>
<td>43.83151104313369</td>
<td>12</td>
<td>47</td>
<td>25</td>
<td>26.63744994317875</td>
</tr>
<tr class="odd">
<td>1956</td>
<td>13</td>
<td>67</td>
<td>26</td>
<td>43.08506131207035</td>
<td>12</td>
<td>48</td>
<td>25</td>
<td>25.929199837782704</td>
</tr>
<tr class="even">
<td>1960</td>
<td>12</td>
<td>65</td>
<td>25</td>
<td>38.08302692628261</td>
<td>11</td>
<td>39</td>
<td>24</td>
<td>20.080557267666588</td>
</tr>
<tr class="odd">
<td>1964</td>
<td>12</td>
<td>60</td>
<td>25</td>
<td>31.975105597154663</td>
<td>13</td>
<td>53</td>
<td>24</td>
<td>21.768654166104547</td>
</tr>
<tr class="even">
<td>1968</td>
<td>11</td>
<td>68</td>
<td>24</td>
<td>36.317311148018874</td>
<td>11</td>
<td>51</td>
<td>24</td>
<td>18.71876641678888</td>
</tr>
<tr class="odd">
<td>1972</td>
<td>12</td>
<td>69</td>
<td>24</td>
<td>35.930160546839694</td>
<td>13</td>
<td>42</td>
<td>24</td>
<td>19.98596052286161</td>
</tr>
<tr class="even">
<td>1976</td>
<td>12</td>
<td>70</td>
<td>23</td>
<td>32.802134361215664</td>
<td>12</td>
<td>46</td>
<td>23</td>
<td>21.7698320494643</td>
</tr>
<tr class="odd">
<td>1980</td>
<td>13</td>
<td>70</td>
<td>23</td>
<td>27.768520445745068</td>
<td>13</td>
<td>49</td>
<td>23</td>
<td>18.154642359559396</td>
</tr>
<tr class="even">
<td>1984</td>
<td>12</td>
<td>60</td>
<td>24</td>
<td>30.05881562619138</td>
<td>15</td>
<td>53</td>
<td>23</td>
<td>16.397695807730326</td>
</tr>
<tr class="odd">
<td>1988</td>
<td>13</td>
<td>70</td>
<td>24</td>
<td>29.150256275905534</td>
<td>11</td>
<td>52</td>
<td>23</td>
<td>17.46205581946204</td>
</tr>
<tr class="even">
<td>1992</td>
<td>11</td>
<td>62</td>
<td>24</td>
<td>29.238076996153065</td>
<td>13</td>
<td>46</td>
<td>24</td>
<td>17.08599797046234</td>
</tr>
<tr class="odd">
<td>1994</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>13</td>
<td>46</td>
<td>24</td>
<td>17.603527791814635</td>
</tr>
<tr class="even">
<td>1996</td>
<td>12</td>
<td>63</td>
<td>24</td>
<td>30.263060247773502</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>1998</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>14</td>
<td>50</td>
<td>25</td>
<td>19.702398658160618</td>
</tr>
<tr class="even">
<td>2000</td>
<td>13</td>
<td>63</td>
<td>25</td>
<td>29.60243153446837</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>2002</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>15</td>
<td>48</td>
<td>25</td>
<td>22.23690379230238</td>
</tr>
<tr class="even">
<td>2004</td>
<td>13</td>
<td>57</td>
<td>25</td>
<td>31.13741181652509</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>2006</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>14</td>
<td>52</td>
<td>25</td>
<td>23.876212746402683</td>
</tr>
<tr class="even">
<td>2008</td>
<td>12</td>
<td>67</td>
<td>25</td>
<td>32.32947785953114</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>2010</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>15</td>
<td>51</td>
<td>26</td>
<td>25.120888173261157</td>
</tr>
<tr class="even">
<td>2012</td>
<td>13</td>
<td>71</td>
<td>25</td>
<td>32.28653359213402</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td>2014</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>15</td>
<td>55</td>
<td>25</td>
<td>23.517221690522096</td>
</tr>
<tr class="even">
<td>2016</td>
<td>13</td>
<td>62</td>
<td>26</td>
<td>30.917678201428895</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>I am statisfied with this now, it seems to match the result reported in <a href="https://www.washingtonpost.com/sports/olympics/2021/07/31/oldest-youngest-olympians/">here</a>.</p>
</section>
<section id="what-is-trend-of-age-in-each-season" class="level4">
<h4 class="anchored" data-anchor-id="what-is-trend-of-age-in-each-season">What is trend of age in each season?</h4>
<p>This is a fun question, let‚Äôs try to find the slope of the best fit line across the previous plots. This can be achieved by implementing the equation of the slope of single variable linear regression: <span class="math display">\[b= \frac{n\sum{xy} - \sum{x}\sum{y}}{n\sum{x^2}-(\sum{x})^2}\]</span></p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>select (n<span class="op">*</span>SigmaXY <span class="op">-</span> SigmaX <span class="op">*</span> SigmaY)<span class="op">/</span>(n<span class="op">*</span>SigmaX2 <span class="op">-</span> SigmaX<span class="op">^</span><span class="dv">2</span>) <span class="im">as</span> b <span class="im">from</span> (</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                select cast(Sum(Y) <span class="im">as</span> <span class="bu">float</span>) <span class="im">as</span> SigmaY, </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                       <span class="bu">sum</span>(X<span class="op">^</span><span class="dv">2</span>) <span class="im">as</span> SigmaX2,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                       <span class="bu">sum</span>(X) <span class="im">as</span> SigmaX,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                       <span class="bu">sum</span>(Y<span class="op">*</span>X) <span class="im">as</span> SigmaXY,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>                       count(<span class="op">*</span>) <span class="im">as</span> n</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>                       <span class="im">from</span> (</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>                        SELECT Year<span class="op">-</span><span class="dv">1896</span> <span class="im">as</span> X, </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>                               AVG(cast(Age <span class="im">as</span> <span class="bu">int</span>)) <span class="im">as</span> Y </span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>                        FROM   athlete_events</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>                        WHERE Age <span class="kw">is</span> <span class="kw">not</span> NULL </span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>                              AND Age <span class="op">&lt;&gt;</span> <span class="st">'NA'</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>                              AND Sport <span class="op">&lt;&gt;</span> <span class="st">'Art Competitions'</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>                              AND Season <span class="op">=</span> <span class="st">'Summer'</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>                        GROUP BY Year </span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>                ) t1 </span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>) t2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">b</td>
</tr>
<tr class="even">
<td>-0.4668425612349374</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>SELECT ( n <span class="op">*</span> sigmaxy <span class="op">-</span> sigmax <span class="op">*</span> sigmay ) <span class="op">/</span> ( n <span class="op">*</span> sigmax2 <span class="op">-</span> sigmax<span class="op">^</span><span class="dv">2</span> ) AS b</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>FROM   (SELECT Cast(Sum(y) AS FLOAT) AS SigmaY,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>               Sum(x<span class="op">^</span><span class="dv">2</span>)              AS SigmaX2,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>               Sum(x)                AS SigmaX,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>               Sum(y <span class="op">*</span> x)            AS SigmaXY,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>               Count(<span class="op">*</span>)              AS n</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>        FROM   (SELECT year <span class="op">-</span> <span class="dv">1896</span>           AS X,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>                       Avg(Cast(age AS INT)) AS Y</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>                FROM   athlete_events</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>                WHERE  age IS NOT NULL</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>                       AND age <span class="op">&lt;&gt;</span> <span class="st">'NA'</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>                       AND sport <span class="op">&lt;&gt;</span> <span class="st">'Art Competitions'</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>                       AND season <span class="op">=</span> <span class="st">'Winter'</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>                GROUP  BY year) t1) t2 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">b</td>
</tr>
<tr class="even">
<td>-0.13860606401530068</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can see a stronger negative trend in summer events than in winter events.</p>
</section>
<section id="what-is-the-number-of-participating-nations-for-each-year-and-season" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-number-of-participating-nations-for-each-year-and-season">What is the number of participating nations for each year and season?</h4>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql result <span class="op">&lt;&lt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>SELECT <span class="op">*</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>FROM   (SELECT DISTINCT Year,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                        Season,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                        region</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>        FROM   athlete_events</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>               LEFT JOIN noc_regions</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>                      ON athlete_events.NOC <span class="op">=</span> noc_regions.NOC) t</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>       PIVOT ( Count(region)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>             FOR season IN (Summer,</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>                            Winter) ) piv</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>ORDER  BY Year </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.
Returning data to local variable result</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>result_df <span class="op">=</span> result.DataFrame()</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>result_df.plot.bar(x<span class="op">=</span><span class="st">'Year'</span>, y <span class="op">=</span>[<span class="st">'Summer'</span>, <span class="st">'Winter'</span>], title<span class="op">=</span><span class="st">'# Participating Nations The Olympics'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>&lt;AxesSubplot:title={'center':'# Participating Nations The Olympics'}, xlabel='Year'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Efficient-Data-Analysis-SQL-and-Python_files/figure-html/cell-36-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Few observation: * The number of participating nations has been increasing since the inception of the first Olympic season in 1896. * The first winter Olympics was held in 1924. * Less nations participate in the winter Olympics as compared with the summer ones. * Since 1992, the Olympics are held every two years for alternating seasons.</p>
</section>
<section id="in-which-years-and-seasons-did-iraq-not-participate-in-the-olympics" class="level4">
<h4 class="anchored" data-anchor-id="in-which-years-and-seasons-did-iraq-not-participate-in-the-olympics">In which years and seasons did Iraq not participate in the Olympics?</h4>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>SELECT Year,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>       Season,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>       Sum(Iraq) AS IraqIn</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>FROM   (SELECT DISTINCT Year,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                        Season,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                        region,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                        CASE region</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                          WHEN <span class="st">'Iraq'</span> THEN <span class="dv">1</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>                          ELSE <span class="dv">0</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>                        END AS Iraq</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>        FROM   athlete_events</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>               LEFT JOIN noc_regions</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>                      ON athlete_events.NOC <span class="op">=</span> noc_regions.NOC) t</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>GROUP  BY Year,</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>          Season</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>HAVING Sum(Iraq) <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>ORDER  BY Year </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Year</td>
<td data-quarto-table-cell-role="th">Season</td>
<td data-quarto-table-cell-role="th">IraqIn</td>
</tr>
<tr class="even">
<td>1896</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1900</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="even">
<td>1904</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1906</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="even">
<td>1908</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1912</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="even">
<td>1920</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1924</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>1924</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1928</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>1928</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1932</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>1932</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1936</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>1936</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1948</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>1952</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1952</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="even">
<td>1956</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1956</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="even">
<td>1960</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1964</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>1968</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1972</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="even">
<td>1972</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1976</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>1976</td>
<td>Summer</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1980</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>1984</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1988</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>1992</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="odd">
<td>1994</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>1998</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="odd">
<td>2002</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>2006</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="odd">
<td>2010</td>
<td>Winter</td>
<td>0</td>
</tr>
<tr class="even">
<td>2014</td>
<td>Winter</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="what-is-the-number-of-medals-per-sport-for-sports-which-have-more-than-500-medals-granted" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-number-of-medals-per-sport-for-sports-which-have-more-than-500-medals-granted">What is the number of medals per Sport for sports which have more than 500 medals granted?</h4>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql results <span class="op">&lt;&lt;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>SELECT Sport,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>       COUNT(Medal) AS MedalsGranted</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>FROM   (SELECT DISTINCT CAST(athlete_events.NAME AS CHAR(<span class="dv">100</span>)) AS Name,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                        Games,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>                        region,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>                        Sport,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                        Medal</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>        FROM   athlete_events</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>               LEFT JOIN noc_regions</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>                      ON athlete_events.NOC <span class="op">=</span> noc_regions.NOC</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>        WHERE  Medal IS NOT NULL</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>               AND Medal <span class="op">&lt;&gt;</span> <span class="st">'NA'</span>) t1</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>GROUP  BY Sport</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>HAVING COUNT(Medal) <span class="op">&gt;</span> <span class="dv">500</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>ORDER  BY MedalsGranted DESC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.
Returning data to local variable results</code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> results.DataFrame()</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>results_df.plot.bar(x<span class="op">=</span><span class="st">'Sport'</span>, y<span class="op">=</span><span class="st">'MedalsGranted'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>&lt;AxesSubplot:xlabel='Sport'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Efficient-Data-Analysis-SQL-and-Python_files/figure-html/cell-39-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="which-countries-participated-less-than-5-times-in-the-olympics" class="level4">
<h4 class="anchored" data-anchor-id="which-countries-participated-less-than-5-times-in-the-olympics">Which countries participated less than 5 times in the Olympics?</h4>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>SELECT region,</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>       Count(Games) AS TimesParticipated</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>FROM   (SELECT DISTINCT Games,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                        region</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>        FROM   athlete_events</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>               LEFT JOIN noc_regions</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>                      ON athlete_events.NOC <span class="op">=</span> noc_regions.NOC</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>        WHERE  region IS NOT NULL</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>               AND region <span class="op">&lt;&gt;</span> <span class="st">'NA'</span>) t1</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>GROUP  BY region</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>HAVING Count(Games) <span class="op">&lt;</span> <span class="dv">5</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>ORDER  BY TimesParticipated </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">region</td>
<td data-quarto-table-cell-role="th">TimesParticipated</td>
</tr>
<tr class="even">
<td>Kosovo</td>
<td>1</td>
</tr>
<tr class="odd">
<td>South Sudan</td>
<td>1</td>
</tr>
<tr class="even">
<td>Marshall Islands</td>
<td>3</td>
</tr>
<tr class="odd">
<td>Kiribati</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="which-are-the-top-5-countries-by-the-number-of-judo-players" class="level4">
<h4 class="anchored" data-anchor-id="which-are-the-top-5-countries-by-the-number-of-judo-players">Which are the top 5 countries by the number of Judo players?</h4>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>SELECT TOP <span class="dv">5</span> region,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>       Count(DISTINCT Cast(Name AS NVARCHAR(<span class="dv">50</span>))) NumPlayers</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>       LEFT JOIN noc_regions</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>              ON athlete_events.NOC <span class="op">=</span> noc_regions.NOC</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>WHERE  Sport <span class="op">=</span> <span class="st">'Judo'</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>GROUP  BY region</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>ORDER  BY NumPlayers DESC </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="40">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">region</td>
<td data-quarto-table-cell-role="th">NumPlayers</td>
</tr>
<tr class="even">
<td>Germany</td>
<td>95</td>
</tr>
<tr class="odd">
<td>South Korea</td>
<td>95</td>
</tr>
<tr class="even">
<td>Russia</td>
<td>94</td>
</tr>
<tr class="odd">
<td>France</td>
<td>93</td>
</tr>
<tr class="even">
<td>Japan</td>
<td>93</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="what-is-percentage-of-judo-players-in-each-of-these-countries" class="level4">
<h4 class="anchored" data-anchor-id="what-is-percentage-of-judo-players-in-each-of-these-countries">What is percentage of Judo players in each of these countries?</h4>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql result <span class="op">&lt;&lt;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>SELECT top <span class="dv">20</span> region,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>       ( CAST(COUNT(DISTINCT CAST(Name AS NVARCHAR(<span class="dv">50</span>))) AS FLOAT) <span class="op">/</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>           (SELECT COUNT(DISTINCT CAST(Name AS NVARCHAR(<span class="dv">50</span>))) NumJudoPlayers</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>        FROM</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>           athlete_events</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>        WHERE</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>           sport <span class="op">=</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">'Judo'</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>           ) ) <span class="op">*</span> <span class="dv">100</span> JudoPlayersPercentage</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>       LEFT JOIN noc_regions</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>              ON athlete_events.noc <span class="op">=</span> noc_regions.noc</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>WHERE  sport <span class="op">=</span> <span class="st">'Judo'</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>GROUP  BY region</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>ORDER  BY JudoPlayersPercentage DESC </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.
Returning data to local variable result</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>result_df <span class="op">=</span> result.DataFrame()</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>result_df.plot.bar(x<span class="op">=</span><span class="st">'region'</span>, y<span class="op">=</span><span class="st">'JudoPlayersPercentage'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>&lt;AxesSubplot:xlabel='region'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Efficient-Data-Analysis-SQL-and-Python_files/figure-html/cell-43-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="which-are-the-top-5-countries-by-the-number-of-medals-in-judo" class="level4">
<h4 class="anchored" data-anchor-id="which-are-the-top-5-countries-by-the-number-of-medals-in-judo">Which are the top 5 countries by the number of medals in judo?</h4>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>SELECT TOP <span class="dv">5</span> region,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>             Count(Medal) AS NumMedals</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>FROM   (SELECT DISTINCT CAST(NAME AS CHAR(<span class="dv">100</span>)) AS Name,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>                        Games,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>                        region,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>                        Medal</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>        FROM   athlete_events</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>               LEFT JOIN noc_regions</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>                      ON athlete_events.NOC <span class="op">=</span> noc_regions.NOC</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>        WHERE  sport <span class="op">=</span> <span class="st">'Judo'</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>               AND Medal <span class="op">&lt;&gt;</span> <span class="st">'NA'</span>) t1</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>GROUP  BY region</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>ORDER  BY NumMedals DESC </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="43">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">region</td>
<td data-quarto-table-cell-role="th">NumMedals</td>
</tr>
<tr class="even">
<td>Japan</td>
<td>84</td>
</tr>
<tr class="odd">
<td>France</td>
<td>49</td>
</tr>
<tr class="even">
<td>Russia</td>
<td>43</td>
</tr>
<tr class="odd">
<td>South Korea</td>
<td>43</td>
</tr>
<tr class="even">
<td>Germany</td>
<td>37</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="who-are-the-top-5-players-who-participated-the-largest-number-of-times" class="level4">
<h4 class="anchored" data-anchor-id="who-are-the-top-5-players-who-participated-the-largest-number-of-times">Who are the top 5 players who participated the largest number of times?</h4>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>SELECT TOP <span class="dv">5</span> CAST(NAME AS CHAR(<span class="dv">100</span>)) Name,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>             COUNT(Games)            GamesParticipated</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>FROM   athlete_events</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>WHERE Sport <span class="op">&lt;&gt;</span> <span class="st">'Art Competitions'</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>GROUP  BY CAST(NAME AS CHAR(<span class="dv">100</span>))</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>ORDER  BY GamesParticipated DESC </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * mssql+pyodbc://@localhost\SQLEXPRESS/OlympicsHistory?driver=SQL+Server&amp;trusted_connection=yes
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="44">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Name</td>
<td data-quarto-table-cell-role="th">GamesParticipated</td>
</tr>
<tr class="even">
<td>Heikki Ilmari Savolainen</td>
<td>39</td>
</tr>
<tr class="odd">
<td>Joseph "Josy" Stoffel</td>
<td>38</td>
</tr>
<tr class="even">
<td>Ioannis Theofilakis</td>
<td>36</td>
</tr>
<tr class="odd">
<td>Takashi Ono</td>
<td>33</td>
</tr>
<tr class="even">
<td>Andreas Wecker</td>
<td>32</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>Writing this article was really interesting, and I enjoyed learning about the Olympics things that I didn‚Äôt know. This article is far from being perfect but I feel, it serves its purpose.</p>
<p>Writing SQL statements like this has its benefits as well as its limitations.</p>
<p>Some of the positives include: * The ability to grab the needed data and plot it in Python or apply and subsequent processing to it is very interesting.</p>
<p>Among the limitations are: * If the query returns a large table, Jupyter could freeze and crash. To alleviate this issue, one can limit the size of returned rows by using <code>select top x</code>, for example. * Syntax highlighting, code auto completion, code formatting/linting are missing.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>